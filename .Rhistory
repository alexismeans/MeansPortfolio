pred_source == "Spp" |
(pred_source == "Observed" & Spp %in% spp_pred_species)
)%>%
arrange(Spp)
plot_species_predictions <- function(species_name, predictions, save_plots = FALSE) {
# Filter for this species
dat <- predictions %>% filter(Spp == species_name)
# Prepare annotation text
formula_text <- unique(dat$Formula[dat$source_group == "Predicted"])
r2_text <- unique(dat$R2[dat$source_group == "Predicted"])
pred_source_text <- unique(dat$pred_source[dat$source_group == "Predicted"])
annotation_text <- if (length(formula_text) > 0) {
glue("Source: {pred_source_text}\n{formula_text}\nR² = {r2_text}")
} else {
""
}
# Base theme
base_theme <- theme_bw(base_size = 12) +
theme(
legend.title = element_blank(),
plot.subtitle = element_text(size = 10, face = "italic")
)
# Plot 1: pred_DryWeight vs Percent
p1 <- ggplot(dat, aes(x = Percent, y = pred_DryWeight, color = source_group)) +
geom_point(size = 2, alpha = 0.8) +
labs(
title = glue("{species_name} — Predicted Dry Weight"),
subtitle = annotation_text,
x = "Percent Cover",
y = "Predicted Dry Weight (g)"
) +
base_theme
# Plot 2: pred_DryWeight vs ID
p2 <- ggplot(dat, aes(x = ID, y = pred_DryWeight, color = source_group)) +
geom_point(size = 2, alpha = 0.8) +
labs(
x = "Observation ID",
y = "Predicted Dry Weight (g)"
) +
base_theme
# Combine plots side by side with legend at bottom
combined_plot <- p1 + p2 +
plot_layout(guides = "collect") &
theme(legend.position = "bottom", legend.direction = "horizontal")
# Save or display
if (save_plots) {
ggsave(glue("plots/{species_name}_pred_plot.png"), combined_plot, width = 10, height = 5, dpi = 300)
} else {
print(combined_plot)
}
}
# Run for this subset
walk(unique(spp_predictions_filtered$Spp), ~plot_species_predictions(.x, spp_predictions_filtered))
datatable(
used_equations,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Table: Model Equations"
)
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula,.keep_all = TRUE) %>%
filter(!if_any(everything(), ~ grepl("observed", .x, ignore.case = TRUE))) %>%
select(-DryWeight, -pred_DryWeight, -Percent, -source_group, -ID, -PlotID)
datatable(
used_equations,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Table: Model Equations"
)
zeros <- predictions %>%
filter(Percent > 20 & pred_DryWeight == 0) %>%
select(ID, Spp, Family, Genus, FunctionalGroup, pred_DryWeight, Percent,pred_source, R2, Formula)
datatable(
zeros,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Flagged Predictions with Low Biomass"
)
#|warning: FALSE
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula, .keep_all = TRUE)
low_r <- predictions %>%
distinct(R2, .keep_all = TRUE) %>%
filter(R2 < 0.6) %>%
select(Spp, Family, Genus, FunctionalGroup, pred_source, R2, Formula)
datatable(
low_r,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Low R-Squared"
)
addWorksheet(wb, "Used.Equations")
wb3 <- createWorkbook()
addWorksheet(wb3, "Used.Equations")
writeData(wb3, "Used.Equations", used_equations)
spp_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Species-Top-Model-List.rds")
fam_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Family-Top-Model-List.rds")
genus_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Genus-Top-Model-List.rds")
fg_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Functional-Group-Top-Model-List.rds")
all_models <- list(
spp   = spp_model,
fam   = fam_model,
genus = genus_model,
fg    = fg_model
)
#| warning: FALSE
library(tidyverse)
library(readr)
library(readxl)
library(DT)
library(openxlsx)
spp <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/spp_models_diagnostics.xlsx"
genus <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/genus_models_diagnostics.xlsx"
fam <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/family_models_diagnostics.xlsx"
fg <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/fg_models_diagnostics.xlsx"
df <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/24and25predictions.xlsx"
spp_predictions <- read_excel(spp, "Sheet1")
genus_predictions <- read_excel(genus, "Sheet1")
fam_predictions <- read_excel(fam, "Sheet1")
fg_predictions <- read_excel(fg, "Sheet1")
predictions <- read_excel(df, "Sheet1")
pred <- predictions %>%
select(ID, Spp, pred_DryWeight, Percent, pred_source)
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula,.keep_all = TRUE) %>%
filter(!if_any(everything(), ~ grepl("observed", .x, ignore.case = TRUE))) %>%
select(-DryWeight, -pred_DryWeight, -Percent, -source_group, -ID, -PlotID)
datatable(
used_equations,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Used Equations"
)
library(openxlsx)
wb3 <- createWorkbook()
addWorksheet(wb3, "Used.Equations")
writeData(wb3, "Used.Equations", used_equations)
addWorksheet(wb3, "Low.R")
writeData(wb3, "Low.R", low_r)
#|warning: FALSE
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula, .keep_all = TRUE)
low_r <- predictions %>%
distinct(R2, .keep_all = TRUE) %>%
filter(R2 < 0.6) %>%
select(Spp, Family, Genus, FunctionalGroup, pred_source, R2, Formula)
datatable(
low_r,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Low R-Squared"
)
addWorksheet(wb3, "Low.R")
spp_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Species-Top-Model-List.rds")
fam_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Family-Top-Model-List.rds")
genus_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Genus-Top-Model-List.rds")
fg_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Functional-Group-Top-Model-List.rds")
all_models <- list(
spp   = spp_model,
fam   = fam_model,
genus = genus_model,
fg    = fg_model
)
#| warning: FALSE
library(tidyverse)
library(readr)
library(readxl)
library(DT)
library(openxlsx)
spp <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/spp_models_diagnostics.xlsx"
genus <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/genus_models_diagnostics.xlsx"
fam <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/family_models_diagnostics.xlsx"
fg <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/fg_models_diagnostics.xlsx"
df <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/24and25predictions.xlsx"
spp_predictions <- read_excel(spp, "Sheet1")
genus_predictions <- read_excel(genus, "Sheet1")
fam_predictions <- read_excel(fam, "Sheet1")
fg_predictions <- read_excel(fg, "Sheet1")
predictions <- read_excel(df, "Sheet1")
pred <- predictions %>%
select(ID, Spp, pred_DryWeight, Percent, pred_source)
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula,.keep_all = TRUE) %>%
filter(!if_any(everything(), ~ grepl("observed", .x, ignore.case = TRUE))) %>%
select(-DryWeight, -pred_DryWeight, -Percent, -source_group, -ID, -PlotID)
datatable(
used_equations,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Used Equations"
)
library(openxlsx)
wb3 <- createWorkbook()
addWorksheet(wb3, "Used.Equations")
writeData(wb3, "Used.Equations", used_equations)
#|warning: FALSE
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula, .keep_all = TRUE)
low_r <- predictions %>%
distinct(R2, .keep_all = TRUE) %>%
filter(R2 < 0.6) %>%
select(Spp, Family, Genus, FunctionalGroup, pred_source, R2, Formula)
datatable(
low_r,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Low R-Squared"
)
addWorksheet(wb3, "Low.R")
writeData(wb3, "Low.R", low_r)
zeros <- predictions %>%
filter(Percent > 20 & pred_DryWeight == 0) %>%
select(ID, Spp, Family, Genus, FunctionalGroup, pred_DryWeight, Percent,pred_source, R2, Formula)
datatable(
zeros,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Flagged Predictions with Low Biomass"
)
addWorksheet(wb3, "Flagged.Zeros")
writeData(wb3, "Flagged.Zeros", zeros)
write.xlsx(wb3, "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regress.equation.compare.xlsx)
zeros <- predictions %>%
filter(Percent > 20 & pred_DryWeight == 0) %>%
select(ID, Spp, Family, Genus, FunctionalGroup, pred_DryWeight, Percent,pred_source, R2, Formula)
datatable(
zeros,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Flagged Predictions with Low Biomass"
)
addWorksheet(wb3, "Flagged.Zeros")
write.xlsx(wb3, "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regress.equation.compare2.xlsx)
spp_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Species-Top-Model-List.rds")
spp_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Species-Top-Model-List.rds")
fam_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Family-Top-Model-List.rds")
genus_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Genus-Top-Model-List.rds")
fg_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Functional-Group-Top-Model-List.rds")
all_models <- list(
spp   = spp_model,
fam   = fam_model,
genus = genus_model,
fg    = fg_model
)
#| warning: FALSE
library(tidyverse)
library(readr)
library(readxl)
library(DT)
library(openxlsx)
spp <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/spp_models_diagnostics.xlsx"
genus <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/genus_models_diagnostics.xlsx"
fam <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/family_models_diagnostics.xlsx"
fg <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/fg_models_diagnostics.xlsx"
df <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/24and25predictions.xlsx"
spp_predictions <- read_excel(spp, "Sheet1")
genus_predictions <- read_excel(genus, "Sheet1")
fam_predictions <- read_excel(fam, "Sheet1")
fg_predictions <- read_excel(fg, "Sheet1")
predictions <- read_excel(df, "Sheet1")
pred <- predictions %>%
select(ID, Spp, pred_DryWeight, Percent, pred_source)
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula,.keep_all = TRUE) %>%
filter(!if_any(everything(), ~ grepl("observed", .x, ignore.case = TRUE))) %>%
select(-DryWeight, -pred_DryWeight, -Percent, -source_group, -ID, -PlotID)
datatable(
used_equations,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Used Equations"
)
library(openxlsx)
wb3 <- createWorkbook()
addWorksheet(wb3, "Used.Equations")
writeData(wb3, "Used.Equations", used_equations)
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula, .keep_all = TRUE)
low_r <- predictions %>%
distinct(R2, .keep_all = TRUE) %>%
filter(R2 < 0.6) %>%
select(Spp, Family, Genus, FunctionalGroup, pred_source, R2, Formula)
datatable(
low_r,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Low R-Squared"
)
addWorksheet(wb3, "Low.R")
writeData(wb3, "Low.R", low_r)
zeros <- predictions %>%
filter(Percent > 20 & pred_DryWeight == 0) %>%
select(ID, Spp, Family, Genus, FunctionalGroup, pred_DryWeight, Percent,pred_source, R2, Formula)
datatable(
zeros,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Flagged Predictions with Low Biomass"
)
addWorksheet(wb3, "Flagged.Zeros")
writeData(wb3, "Flagged.Zeros", zeros)
write.xlsx(wb3, "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regress.equation.compare2.xlsx)
write.xlsx(wb3, "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regress.equation.compare2.xlsx")
write.xlsx(wb3, "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regress.equation.compare2.xlsx")
spp_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Species-Top-Model-List.rds")
fam_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Family-Top-Model-List.rds")
genus_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Genus-Top-Model-List.rds")
fg_model <- readRDS("C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regression_equations/24and25-Biomass-Regression-Functional-Group-Top-Model-List.rds")
all_models <- list(
spp   = spp_model,
fam   = fam_model,
genus = genus_model,
fg    = fg_model
)
#| warning: FALSE
library(tidyverse)
library(readr)
library(readxl)
library(DT)
library(openxlsx)
spp <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/spp_models_diagnostics.xlsx"
genus <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/genus_models_diagnostics.xlsx"
fam <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/family_models_diagnostics.xlsx"
fg <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/processed.data/fg_models_diagnostics.xlsx"
df <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/24and25predictions.xlsx"
spp_predictions <- read_excel(spp, "Sheet1")
genus_predictions <- read_excel(genus, "Sheet1")
fam_predictions <- read_excel(fam, "Sheet1")
fg_predictions <- read_excel(fg, "Sheet1")
predictions <- read_excel(df, "Sheet1")
pred <- predictions %>%
select(ID, Spp, pred_DryWeight, Percent, pred_source)
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula,.keep_all = TRUE) %>%
filter(!if_any(everything(), ~ grepl("observed", .x, ignore.case = TRUE))) %>%
select(-DryWeight, -pred_DryWeight, -Percent, -source_group, -ID, -PlotID)
datatable(
used_equations,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Used Equations"
)
library(openxlsx)
wb3 <- createWorkbook()
addWorksheet(wb3, "Used.Equations")
writeData(wb3, "Used.Equations", used_equations)
#|warning: FALSE
#left join this to covariate dbs
used_equations <- predictions %>%
distinct(Formula, .keep_all = TRUE)
low_r <- predictions %>%
distinct(R2, .keep_all = TRUE) %>%
filter(R2 < 0.6) %>%
select(Spp, Family, Genus, FunctionalGroup, pred_source, R2, Formula)
datatable(
low_r,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Low R-Squared"
)
addWorksheet(wb3, "Low.R")
writeData(wb3, "Low.R", low_r)
zeros <- predictions %>%
filter(Percent > 20 & pred_DryWeight == 0) %>%
select(ID, Spp, Family, Genus, FunctionalGroup, pred_DryWeight, Percent,pred_source, R2, Formula)
datatable(
zeros,
options = list(
pageLength = 20,        # show more rows per page
scrollX = TRUE,         # horizontal scrolling for wide tables
scrollY = "400px",      # limit vertical size
dom = "tip",            # minimal controls (t = table, i = info, p = pagination)
columnDefs = list(
list(className = 'dt-center', targets = "_all")  # center-align
)
),
class = "compact stripe hover",
caption = "Flagged Predictions with Low Biomass"
)
addWorksheet(wb3, "Flagged.Zeros")
writeData(wb3, "Flagged.Zeros", zeros)
write.xlsx(wb3, "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regress.equation.compare2.xlsx")
saveWorkbook(wb3, "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/regress.equation.compare2.xlsx")
