{
  "hash": "706bd10f39f07c64b0d0bc8024cf8618",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Edited Predictions\"\nauthor: \"Alexis Means\"\ndate: \"2025-11-20\"\nformat:\n  html:\n    toc: true\n    toc-location: left\n    toc-depth: 3\neditor: visual\ncode-fold: true\nexecute: \n  warning: false\n  message: false\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\ns <- \"C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/edited.spp.pred.xlsx\"\ng <- \"C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/edited.genus.pred.xlsx\"\nf <- \"C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/biomass/edited.fg.pred.xlsx\"\n\nspp <- read_excel(s, \"Sheet1\")\ngenus <-read_excel(g, \"Sheet1\") \nfg <- read_excel(f, \"Sheet1\")\n```\n:::\n\n\n## Species\n\nERST4_ENTIRE - looks better. POSE_BROWN, PSSP6_GREEN - I think look better, but I am not confident. The rest look the same or worse\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(purrr)\nlibrary(glue)\nlibrary(patchwork)\n\n# 2. Keep Spp predictions and matching Observed rows\nspp_predictions_filtered <- spp %>%\n  mutate(pred_source = ifelse(pred_source == \"Model_Spp\", \"Predicted\", pred_source)) %>%\n  filter(!ID %in% 661) %>% \n  arrange(Spp)\n\nplot_species_predictions <- function(species_name, predictions, save_plots = FALSE) {\n  \n  # Filter for this species\n  dat <- predictions %>% filter(Spp == species_name)\n  \n  # Prepare annotation text\n  formula_text <- unique(dat$formula[dat$pred_source == \"Predicted\"])\n  r2_text      <- unique(dat$R2[dat$pred_source == \"Predicted\"])\n  pred_source_text <- unique(dat$pred_source[dat$pred_source == \"Predicted\"])\n  \n  annotation_text <- if (length(formula_text) > 0) {\n    glue(\"Source: {pred_source_text}\\n{formula_text}\\nR² = {r2_text}\")\n  } else {\n    \"\"\n  }\n  \n  # Base theme\n  base_theme <- theme_bw(base_size = 12) +\n    theme(\n      legend.title = element_blank(),\n      plot.subtitle = element_text(size = 10, face = \"italic\")\n    )\n  \n  # Plot 1: pred_DryWeight vs Percent\n  p1 <- ggplot(dat, aes(x = Percent, y = pred_DryWeight, color = pred_source)) +\n    geom_point(size = 2, alpha = 0.8) +\n    labs(\n      title = glue(\"{species_name} — Predicted Dry Weight\"),\n      subtitle = annotation_text,\n      x = \"Percent Cover\",\n      y = \"Predicted Dry Weight (g)\"\n    ) +\n    base_theme\n  \n  # Plot 2: pred_DryWeight vs ID\n  p2 <- ggplot(dat, aes(x = ID, y = pred_DryWeight, color = pred_source)) +\n    geom_point(size = 2, alpha = 0.8) +\n    labs(\n      x = \"Observation ID\",\n      y = \"Predicted Dry Weight (g)\"\n    ) +\n    base_theme\n  \n  # Combine plots\n  combined_plot <- p1 + p2 + \n    plot_layout(guides = \"collect\") & \n    theme(legend.position = \"bottom\", legend.direction = \"horizontal\")\n  \n  # Save or display\n  if (save_plots) {\n    ggsave(glue(\"plots/{species_name}_pred_plot.png\"),\n           combined_plot, width = 10, height = 5, dpi = 300)\n  } else {\n    print(combined_plot)\n  }\n}\n\n# Run for this subset\nwalk(unique(spp_predictions_filtered$Spp), ~plot_species_predictions(.x, spp_predictions_filtered))\n```\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-2-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-2-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-2-6.png){width=672}\n:::\n:::\n\n\n## Genus\n\nASTRAGULUS, POA, PSEUDOGENERIA, TAENATHARIUM look better.\n\nSince Taenatharium (The Genus for TACA8) is predicting a lot better at the genus level, can I use this equations instead of TACA8_GREEN at the species level because that one is still predicting zeros at high percent covers where this one is not.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenus_predictions_filtered <- genus %>%\n  mutate(pred_source = ifelse(pred_source == \"Model_Genus\", \"Predicted\", pred_source)) %>%\n  arrange(Genus)\n\nplot_genus_predictions <- function(genus_name, predictions, save_plots = FALSE) {\n  \n  # Filter for this genus\n  dat <- predictions %>% filter(Genus == genus_name)\n  \n  # Prepare annotation text\n  formula_text <- unique(dat$formula[dat$pred_source == \"Predicted\"])\n  r2_text      <- unique(dat$R2[dat$pred_source == \"Predicted\"])\n  pred_source_text <- unique(dat$pred_source[dat$pred_source == \"Predicted\"])\n  \n  annotation_text <- if (length(formula_text) > 0) {\n    glue(\"Source: {pred_source_text}\\n{formula_text}\\nR² = {r2_text}\")\n  } else {\n    \"\"\n  }\n  \n  # Base theme\n  base_theme <- theme_bw(base_size = 12) +\n    theme(\n      legend.title = element_blank(),\n      plot.subtitle = element_text(size = 10, face = \"italic\")\n    )\n  \n  # Plot 1: pred_DryWeight vs Percent\n  p1 <- ggplot(dat, aes(x = Percent, y = pred_DryWeight, color = pred_source)) +\n    geom_point(size = 2, alpha = 0.8) +\n    labs(\n      title = glue(\"{genus_name} — Predicted Dry Weight\"),\n      subtitle = annotation_text,\n      x = \"Percent Cover\",\n      y = \"Predicted Dry Weight (g)\"\n    ) +\n    base_theme\n  \n  # Plot 2: pred_DryWeight vs ID\n  p2 <- ggplot(dat, aes(x = ID, y = pred_DryWeight, color = pred_source)) +\n    geom_point(size = 2, alpha = 0.8) +\n    labs(\n      x = \"Observation ID\",\n      y = \"Predicted Dry Weight (g)\"\n    ) +\n    base_theme\n  \n  # Combine plots side by side\n  combined_plot <- p1 + p2 + \n    plot_layout(guides = \"collect\") & \n    theme(legend.position = \"bottom\", legend.direction = \"horizontal\")\n  \n  # Save or display\n  if (save_plots) {\n    ggsave(glue(\"plots/{genus_name}_pred_plot.png\"),\n           combined_plot, width = 10, height = 5, dpi = 300)\n  } else {\n    print(combined_plot)\n  }\n}\n\nwalk(unique(genus_predictions_filtered$Genus),\n     ~plot_genus_predictions(.x, genus_predictions_filtered))\n```\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-3-4.png){width=672}\n:::\n:::\n\n\n## Functional Group\n\nRemoving the outliers did not change these at all, the predictions are the same\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfg_predictions_filtered <- fg %>%\n  mutate(\n    pred_source = ifelse(pred_source == \"Model_FunctionalGroup\", \"Predicted\", pred_source)\n  ) %>%\n  filter(\n    (pred_source == \"Observed\" | \n     (pred_source == \"Predicted\" & Spp %in% c(\n       \"HOUM_ENTIRE\", \"COPA3_ENTIRE\", \"EQHY_ENTIRE\", \"HYCA4_ENTIRE\",\n       \"PHHE2_ENTIRE\", \"MIGU_ENTIRE\", \"CLLI2_ENTIRE\", \"POGLG4_ENTIRE\",\n       \"SANI5_ENTIRE\", \"VETH_ENTIRE\"\n     ))) &\n    !ID %in% c(2178, 2087)\n  ) %>%\n  arrange(FunctionalGroup)\n\nplot_fg_predictions <- function(fg_name, predictions, save_plots = FALSE) {\n  \n  # Filter for this functional group\n  dat <- predictions %>% filter(FunctionalGroup == fg_name)\n  \n  # Prepare annotation text\n  formula_text <- unique(dat$formula[dat$pred_source == \"Predicted\"])\n  r2_text      <- unique(dat$R2[dat$pred_source == \"Predicted\"])\n  pred_source_text <- unique(dat$pred_source[dat$pred_source == \"Predicted\"])\n  \n  annotation_text <- if (length(formula_text) > 0) {\n    glue(\"Source: {pred_source_text}\\n{formula_text}\\nR² = {r2_text}\")\n  } else {\n    \"\"\n  }\n  \n  # Base theme\n  base_theme <- theme_bw(base_size = 12) +\n    theme(\n      legend.title = element_blank(),\n      plot.subtitle = element_text(size = 10, face = \"italic\")\n    )\n  \n  # Plot 1: pred_DryWeight vs Percent\n  p1 <- ggplot(dat, aes(x = Percent, y = pred_DryWeight, color = pred_source)) +\n    geom_point(size = 2, alpha = 0.8) +\n    labs(\n      title = glue(\"{fg_name} — Predicted Dry Weight\"),\n      subtitle = annotation_text,\n      x = \"Percent Cover\",\n      y = \"Predicted Dry Weight (g)\"\n    ) +\n    base_theme\n  \n  # Plot 2: pred_DryWeight vs ID\n  p2 <- ggplot(dat, aes(x = ID, y = pred_DryWeight, color = pred_source)) +\n    geom_point(size = 2, alpha = 0.8) +\n    labs(\n      x = \"Observation ID\",\n      y = \"Predicted Dry Weight (g)\"\n    ) +\n    base_theme\n  \n  # Combine plots\n  combined_plot <- p1 + p2 + \n    plot_layout(guides = \"collect\") & \n    theme(legend.position = \"bottom\", legend.direction = \"horizontal\")\n  \n  # Save or display\n  if (save_plots) {\n    ggsave(glue(\"plots/{fg_name}_pred_plot.png\"),\n           combined_plot, width = 10, height = 5, dpi = 300)\n  } else {\n    print(combined_plot)\n  }\n}\n\nwalk(unique(fg_predictions_filtered$FunctionalGroup),\n     ~plot_fg_predictions(.x, fg_predictions_filtered))\n```\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](edited.biomass.predictions_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "edited.biomass.predictions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}