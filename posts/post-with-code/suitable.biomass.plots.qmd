---
title: "Suitable Biomass Comparisons"
author: "Alexis Means"
code-fold: TRUE
---

```{r}
#| warning: FALSE
#| message: FALSE
library(readr)
library(readxl)
library(tidyverse)


r <- "C:/Users/Alexis Means/Documents/Project/Nutrition Sampling/R code/FRESH/processed.data/total.results.xlsx"

plot.totals <- read_excel(r, "Plot-Level-Summary")
indiv.value <- read_excel(r, "Total.Output")


```

# Scatterplots

## Total Suitable Biomass Over Time by PVT

```{r}
#| warning: FALSE
#| message: FALSE
library(lubridate)

plot.totals$Date <- ymd(plot.totals$Date)
plot.totals$Julian_Day <- yday(plot.totals$Date)

plot.totals <- plot.totals %>% 
  select(-PVT, -PVTedit) %>% 
  rename(PVT = PVT_Observed)

# Create month breaks based on your actual data
month_breaks <- plot.totals %>%
  mutate(Month = floor_date(Date, "month")) %>%
  distinct(Month) %>%
  arrange(Month) %>%
  mutate(Julian_Day = yday(Month),
         Label = format(Month, "%b"))  # Abbreviated month name

ggplot(plot.totals, aes(x = Julian_Day, y = SuitableBiomass)) +
  geom_point() +
  geom_line(aes(group = TransectID), alpha = 0.4) +
  facet_wrap(~ PVT) +
  scale_y_continuous(limits = c(0, 1000)) +
  scale_x_continuous(
    breaks = month_breaks$Julian_Day,
    labels = month_breaks$Label
  ) +
  theme_minimal() +
  labs(
    title = "Suitable Biomass Over Time by PVT",
    x = "Date",
    y = "Suitable Biomass (kg/ha)"
  )


```

## Average DE Over Time by PVT

```{r}
#| warning: FALSE
#| message: FALSE
ggplot(plot.totals, aes(x = Julian_Day, y = AveDE)) +
  geom_point() +
  geom_hline(yintercept = 11.5, linetype = "dashed", color = "red", size = 0.8) +
  facet_wrap(~ PVT) +
  scale_y_continuous(limits = c(9, 14)) +
  scale_x_continuous(
    breaks = month_breaks$Julian_Day,
    labels = month_breaks$Label
  ) +
  theme_minimal() +
  labs(
    title = "Average Digestible Energy Over Time by PVT",
    x = "Date",
    y = "Average DE (KJ/g)"
  )
```

## Average DP Over Time by PVT

```{r}
#| warning: FALSE
#| message: FALSE
ggplot(plot.totals, aes(x = Julian_Day, y = AveDP)) +
  geom_point() +
  geom_hline(yintercept = 7.5, linetype = "dashed", color = "red", size = 0.8) +
  facet_wrap(~ PVT) +
  scale_y_continuous(limits = c(2, 16)) +
   scale_x_continuous(
    breaks = month_breaks$Julian_Day,
    labels = month_breaks$Label
  ) +
  theme_minimal() +
  labs(
    title = "Average Digestible Protien Over Time by PVT",
    x = "Date",
    y = "Average DP (g/100g)"
  )
```

# Bargraphs

## Average Suitable Biomass

```{r}
avg_sb <- plot.totals %>% 
  group_by(PVT) %>% 
  summarise(
    mean_sb = mean(SuitableBiomass, na.rm = TRUE),
    se_sb   = sd(SuitableBiomass, na.rm = TRUE) / sqrt(n())
  )

# Create bar plot with standard error bars
ggplot(avg_sb, aes(x = factor(PVT), y = mean_sb)) +
  geom_col(fill = "steelblue") +
  geom_errorbar(aes(ymin = mean_sb - se_sb, ymax = mean_sb + se_sb),
                width = 0.2, color = "black") +
  scale_y_continuous(limits = c(0, 700)) +
  theme_minimal() +
  labs(
    title = "Average Suitable Biomass by PVT",
    x = "PVT",
    y = "Mean Suitable Biomass (kg/ha)"
  )
```

## Average DE

```{r}
# Calculate mean and standard error for AveDE by PVT
avg_DE <- plot.totals %>% 
  group_by(PVT) %>% 
  summarise(
    mean_DE = mean(AveDE, na.rm = TRUE),
    se_DE   = sd(AveDE, na.rm = TRUE) / sqrt(n())
  )

# Bar plot with dashed line and standard error bars
ggplot(avg_DE, aes(x = factor(PVT), y = mean_DE)) +
  geom_col(fill = "steelblue") +
  geom_errorbar(aes(ymin = mean_DE - se_DE, ymax = mean_DE + se_DE),
                width = 0.2, color = "black") +
  geom_hline(yintercept = 11.5, linetype = "dashed", color = "red", size = 0.8) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_minimal() +
  labs(
    title = "Average DE by PVT",
    x = "PVT",
    y = "Mean DE (KJ/g)"
  )
```

## Average DP

```{r}
# Calculate mean and standard error for AveDP by PVT
avg_DP <- plot.totals %>% 
  group_by(PVT) %>% 
  summarise(
    mean_DP = mean(AveDP, na.rm = TRUE),
    se_DP   = sd(AveDP, na.rm = TRUE) / sqrt(n())
  )

# Bar plot with dashed line and standard error bars
ggplot(avg_DP, aes(x = factor(PVT), y = mean_DP)) +
  geom_col(fill = "steelblue") +
  geom_errorbar(aes(ymin = mean_DP - se_DP, ymax = mean_DP + se_DP),
                width = 0.2, color = "black") +
  geom_hline(yintercept = 7.5, linetype = "dashed", color = "red", size = 0.8) +
  scale_y_continuous(limits = c(0, 13)) +
  theme_minimal() +
  labs(
    title = "Average DP by PVT",
    x = "PVT",
    y = "Mean DP (g/100g)"
  )
```
